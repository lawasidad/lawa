const customerSelect = document.getElementById('customerSelect');

function populateCustomerSelect() {
  const orders = getOrders();
  const customers = [...new Set(orders.map(o => o.name))]; // یەکتایی ناوی کریارەکان

  // پاککردنی هەموو هەڵبژاردەکان دواتر زیادکردنی نوێ
  customerSelect.innerHTML = '<option value="all">هەموو کریارەکان</option>';

  customers.forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    option.textContent = name;
    customerSelect.appendChild(option);
  });
}

// گۆڕینی هەلبژاردن بەردەوامکردنی فلتەر
customerSelect.addEventListener('change', () => {
  renderOrders(); // نوێکردنەوەی وەسڵەکان بە پەیوەندی بە هەلبژاردن
});

// گۆڕینی renderOrders بۆ فلتەرکردنی وەسڵەکان
function renderOrders() {
  const orders = getOrders();
  const selectedCustomer = customerSelect.value;

  // فلتەرکردن بەرەوپێش ئەگەر نەهەموو هەلبژێردرا
  const filteredOrders = selectedCustomer === 'all'
    ? orders
    : orders.filter(order => order.name === selectedCustomer);

  if (filteredOrders.length === 0) {
    ordersContainer.innerHTML = '<p class="no-orders">هیچ داواکاریەک نییە.</p>';
    return;
  }

  ordersContainer.innerHTML = '';

  filteredOrders.forEach((order, index) => {
    const productsHTML = order.products.map(createProductHTML).join('');
    const totalAmount = order.products.reduce((sum, p) => sum + Number(p.price || 0), 0);

    const orderHTML = document.createElement('div');
    orderHTML.className = 'order';
    orderHTML.dataset.index = index;

    orderHTML.innerHTML = `
      <div style="margin-bottom: 10px">
        <input type="checkbox" class="order-checkbox" data-index="${index}" /> وەسلەکە هەلبژێرە
      </div>
      <div class="order-header">
        <span>ناوی کریار: ${order.name}</span>
        <span>ژمارە مۆبایل: ${order.mobile}</span>
      </div>
      <div class="order-info">
        ناونیشان: ${order.address}<br/>
        GPS: ${order.gps}<br/>
        کاتی داواکاری: ${order.time}<br/>
        <strong>💰 کۆی گشتی پارە: ${totalAmount.toLocaleString()} دینار</strong>
      </div>
      <div class="products">${productsHTML}</div>
    `;

    ordersContainer.prepend(orderHTML);
  });
}
