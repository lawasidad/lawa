const customerSelect = document.getElementById('customerSelect');

function populateCustomerSelect() {
  const orders = getOrders();
  const customers = [...new Set(orders.map(o => o.name))]; // ÛŒÛ•Ú©ØªØ§ÛŒÛŒ Ù†Ø§ÙˆÛŒ Ú©Ø±ÛŒØ§Ø±Û•Ú©Ø§Ù†

  // Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Û•Ú©Ø§Ù† Ø¯ÙˆØ§ØªØ± Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù†ÙˆÛŽ
  customerSelect.innerHTML = '<option value="all">Ù‡Û•Ù…ÙˆÙˆ Ú©Ø±ÛŒØ§Ø±Û•Ú©Ø§Ù†</option>';

  customers.forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    option.textContent = name;
    customerSelect.appendChild(option);
  });
}

// Ú¯Û†Ú•ÛŒÙ†ÛŒ Ù‡Û•Ù„Ø¨Ú˜Ø§Ø±Ø¯Ù† Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù…Ú©Ø±Ø¯Ù†ÛŒ ÙÙ„ØªÛ•Ø±
customerSelect.addEventListener('change', () => {
  renderOrders(); // Ù†ÙˆÛŽÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ ÙˆÛ•Ø³ÚµÛ•Ú©Ø§Ù† Ø¨Û• Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Û• Ù‡Û•Ù„Ø¨Ú˜Ø§Ø±Ø¯Ù†
});

// Ú¯Û†Ú•ÛŒÙ†ÛŒ renderOrders Ø¨Û† ÙÙ„ØªÛ•Ø±Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛ•Ø³ÚµÛ•Ú©Ø§Ù†
function renderOrders() {
  const orders = getOrders();
  const selectedCustomer = customerSelect.value;

  // ÙÙ„ØªÛ•Ø±Ú©Ø±Ø¯Ù† Ø¨Û•Ø±Û•ÙˆÙ¾ÛŽØ´ Ø¦Û•Ú¯Û•Ø± Ù†Û•Ù‡Û•Ù…ÙˆÙˆ Ù‡Û•Ù„Ø¨Ú˜ÛŽØ±Ø¯Ø±Ø§
  const filteredOrders = selectedCustomer === 'all'
    ? orders
    : orders.filter(order => order.name === selectedCustomer);

  if (filteredOrders.length === 0) {
    ordersContainer.innerHTML = '<p class="no-orders">Ù‡ÛŒÚ† Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•.</p>';
    return;
  }

  ordersContainer.innerHTML = '';

  filteredOrders.forEach((order, index) => {
    const productsHTML = order.products.map(createProductHTML).join('');
    const totalAmount = order.products.reduce((sum, p) => sum + Number(p.price || 0), 0);

    const orderHTML = document.createElement('div');
    orderHTML.className = 'order';
    orderHTML.dataset.index = index;

    orderHTML.innerHTML = `
      <div style="margin-bottom: 10px">
        <input type="checkbox" class="order-checkbox" data-index="${index}" /> ÙˆÛ•Ø³Ù„Û•Ú©Û• Ù‡Û•Ù„Ø¨Ú˜ÛŽØ±Û•
      </div>
      <div class="order-header">
        <span>Ù†Ø§ÙˆÛŒ Ú©Ø±ÛŒØ§Ø±: ${order.name}</span>
        <span>Ú˜Ù…Ø§Ø±Û• Ù…Û†Ø¨Ø§ÛŒÙ„: ${order.mobile}</span>
      </div>
      <div class="order-info">
        Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†: ${order.address}<br/>
        GPS: ${order.gps}<br/>
        Ú©Ø§ØªÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ: ${order.time}<br/>
        <strong>ðŸ’° Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù¾Ø§Ø±Û•: ${totalAmount.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</strong>
      </div>
      <div class="products">${productsHTML}</div>
    `;

    ordersContainer.prepend(orderHTML);
  });
}
