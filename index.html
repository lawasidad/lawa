<!DOCTYPE html>
<html lang="ku">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>فۆرمی داواکاری کاڵا</title>
<style>
  body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; background: #f9f9f9;}
  h2 { margin-bottom: 20px; }
  .product-list { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
  .product { border: 2px solid #ccc; border-radius: 10px; padding: 10px; width: 150px; text-align: center; cursor: pointer; user-select: none; background: white; }
  .product.selected { border-color: green; background: #d4edda; }
  .product img { width: 130px; height: 130px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
  .quantity-controls { margin-top: 8px; display: flex; justify-content: center; gap: 10px; }
  .quantity-controls button { background: green; color: white; border: none; border-radius: 6px; width: 28px; height: 28px; font-weight: bold; cursor: pointer; }
  .quantity-controls span { font-weight: bold; min-width: 25px; display: inline-block; text-align: center; }
  form { max-width: 400px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  label { display: block; margin-top: 15px; font-weight: bold; }
  input { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
  input[readonly] { background: #eee; }
  #totalAmount { margin-top: 15px; font-weight: bold; font-size: 18px; color: green; text-align: center; }
</style>
</head>
<body>

<h2>فۆرمی داواکاری کاڵا</h2>

<div class="product-list" id="productList"></div>

<form id="orderForm" autocomplete="off">
  <label for="customerName">ناوی کڕیار</label>
  <input type="text" id="customerName" required placeholder="ناوی خۆت بنووسە" />

  <label for="mobile">ژمارەی مۆبایل</label>
  <input type="text" id="mobile" required placeholder="07XX XXX XXX" />

  <label for="address">ناونیشان</label>
  <input type="text" id="address" required placeholder="ناونیشانت بنووسە" />

  <label for="gps">GPS</label>
  <input type="text" id="gps" readonly placeholder="چاوەڕوانی ناونیشانی GPS..." />

  <label for="note">تێبینی</label>
  <input type="text" id="note" placeholder="تێبینیەکانت بنووسە..." />

  <div id="totalAmount">کۆی گشتی: ٠ دینار</div>
</form>

<script>
  const productList = document.getElementById('productList');
  const totalAmountDiv = document.getElementById('totalAmount');

  let selected = {};
  let gpsCoords = null;

  // نموونە کاڵاکان
  const products = [
    { id: 1, name: "شەکر", price: 2000, image: "https://via.placeholder.com/130?text=شەکر" },
    { id: 2, name: "کافی", price: 5000, image: "https://via.placeholder.com/130?text=کافی" },
    { id: 3, name: "کاکائو", price: 3000, image: "https://via.placeholder.com/130?text=کاکائو" }
  ];

  // نیشاندانی کاڵاکان
  function renderProducts() {
    productList.innerHTML = "";
    let total = 0;
    products.forEach(product => {
      const qty = selected[product.id] || 0;
      const div = document.createElement("div");
      div.className = "product";
      if(qty > 0) div.classList.add("selected");
      div.innerHTML = `
        <img src="${product.image}" alt="${product.name}" />
        <div><b>${product.name}</b></div>
        <div>${product.price.toLocaleString()} دینار</div>
      `;
      if(qty > 0) {
        const controls = document.createElement("div");
        controls.className = "quantity-controls";

        const btnMinus = document.createElement("button");
        btnMinus.type = "button";
        btnMinus.textContent = "-";
        btnMinus.onclick = e => {
          e.stopPropagation();
          if(selected[product.id] > 1) selected[product.id]--;
          else delete selected[product.id];
          updateUI();
        };

        const qtySpan = document.createElement("span");
        qtySpan.textContent = qty;

        const btnPlus = document.createElement("button");
        btnPlus.type = "button";
        btnPlus.textContent = "+";
        btnPlus.onclick = e => {
          e.stopPropagation();
          selected[product.id] = (selected[product.id] || 0) + 1;
          updateUI();
        };

        controls.appendChild(btnMinus);
        controls.appendChild(qtySpan);
        controls.appendChild(btnPlus);

        div.appendChild(controls);

        total += product.price * qty;
      }

      div.onclick = () => {
        if(selected[product.id]) {
          delete selected[product.id];
        } else {
          selected[product.id] = 1;
        }
        updateUI();
      };

      productList.appendChild(div);
    });
    totalAmountDiv.textContent = "کۆی گشتی: " + total.toLocaleString() + " دینار";

    // ئەگەر هەیە کاڵا، ناردنی خۆکار
    if(total > 0) {
      sendOrderAuto();
    }
  }

  // بەرواری ناونیشانی GPS
  function fetchGPS() {
    if(!navigator.geolocation) {
      document.getElementById("gps").value = "GPS نەدۆزرایەوە";
      return;
    }
    navigator.geolocation.getCurrentPosition(pos => {
      gpsCoords = {
        lat: pos.coords.latitude,
        lon: pos.coords.longitude
      };
      document.getElementById("gps").value = `${gpsCoords.lat.toFixed(5)}, ${gpsCoords.lon.toFixed(5)}`;
    }, err => {
      document.getElementById("gps").value = "GPS نەدۆزرایەوە";
    });
  }

  // فەرمی ناردنی داواکاری بە شێوەی خۆکار
  function sendOrderAuto() {
    const name = document.getElementById("customerName").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const address = document.getElementById("address").value.trim();
    const note = document.getElementById("note").value.trim();

    if(!name || !mobile || !address) {
      // ئەگەر خانەکان پڕ نەبێت، ناردن ناکات
      return;
    }
    if(Object.keys(selected).length === 0) {
      // ئەگەر هیچ کاڵاکە هەلبژێردراوە نیە، ناردن ناکات
      return;
    }

    const selectedProducts = products.filter(p => selected[p.id]).map(p => ({
      name: p.name,
      price: p.price,
      quantity: selected[p.id],
      total: p.price * selected[p.id]
    }));

    let message = `وەسڵی داواکاری:\n\nناوی کڕیار: ${name}\nژمارەی مۆبایل: ${mobile}\nناونیشان: ${address}\nGPS: ${gpsCoords ? `${gpsCoords.lat.toFixed(5)}, ${gpsCoords.lon.toFixed(5)}` : "نەدۆزرایەوە"}\nتێبینی: ${note || "نیە"}\n\nکاڵاکان:\n`;

    selectedProducts.forEach(p => {
      message += `- ${p.name} | ژمارە: ${p.quantity} | نرخ: ${p.price.toLocaleString()} دینار | کۆی: ${p.total.toLocaleString()} دینار\n`;
    });

    const totalPrice = selectedProducts.reduce((acc, p) => acc + p.total, 0);
    message += `\nکۆی گشتی: ${totalPrice.toLocaleString()} دینار\n\nسوپاس بۆ کڕینت!`;

    const encodedMsg = encodeURIComponent(message);
    const phone = "9647500000000"; // ژمارە واتساپەکەت لێرە گۆڕە
    const whatsappURL = `https://wa.me/${phone}?text=${encodedMsg}`;

    // کرتە لەسەر لینکەکە بە شێوەی خۆکار
    window.location.href = whatsappURL;
  }

  // نوسینەوە UI
  function updateUI() {
    renderProducts();
  }

  window.onload = () => {
    fetchGPS();
    renderProducts();
  };
</script>

</body>
</html>
