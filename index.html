<!DOCTYPE html>
<html lang="ku">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ú©Û†Ù…Ù¾Ø§Ù†ÛŒØ§ÛŒ Ø¯Û†ÛŒ Ù‚Û•Ù†Ø¯ÛŒÙ„ - Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ú©Ø§ÚµØ§</title>
  <style>
    /* Ú¯Ø´ØªÛŒ */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 15px 20px;
      direction: rtl;
      background: #f7f9fc;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-bottom: 15px;
      color: #1b5e20;
    }

    /* Ù„ÛŒØ³ØªÛŒ Ú©Ø§ÚµØ§ */
    .product-list {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      max-width: 1000px;
      width: 100%;
      margin-bottom: 20px;
    }

    .product {
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      width: 180px;
      cursor: pointer;
      user-select: none;
      padding: 10px;
      box-sizing: border-box;
      text-align: center;
      transition: border-color 0.3s, background-color 0.3s;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .product.selected {
      border-color: #28a745;
      background: #e0f7e9;
      box-shadow: 0 0 10px rgba(40, 167, 69, 0.4);
    }

    .product img {
      width: 160px;
      height: 160px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 10px;
      flex-shrink: 0;
    }

    .product strong {
      font-size: 18px;
      margin-bottom: 5px;
      color: #2e7d32;
    }

    .product .price {
      font-weight: bold;
      color: #388e3c;
      font-size: 16px;
    }

    /* Ø¯Ú©Ù…Ù‡ Ùˆ Ú˜Ù…Ø§Ø±Û• */
    .quantity-controls {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 12px;
      align-items: center;
    }

    .quantity-controls button {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 6px;
      background-color: #28a745;
      color: white;
      font-weight: bold;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      transition: background-color 0.3s;
    }

    .quantity-controls button:hover {
      background-color: #218838;
    }

    .quantity-controls span {
      min-width: 28px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      user-select: none;
      color: #1b5e20;
    }

    /* ÙÛ†Ø±Ù… */
    form {
      max-width: 420px;
      width: 100%;
      background: white;
      padding: 20px 25px;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: sticky;
      top: 20px;
      box-sizing: border-box;
    }

    label {
      font-weight: 600;
      margin-top: 15px;
      display: block;
      color: #2e7d32;
      font-size: 15px;
    }

    input[type=text], select {
      width: 100%;
      padding: 12px 15px;
      margin-top: 6px;
      border: 2px solid #ccc;
      border-radius: 12px;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }

    input[type=text]:focus, select:focus {
      outline: none;
      border-color: #28a745;
      box-shadow: 0 0 6px #a8d5a2;
    }

    button[type=submit] {
      margin-top: 25px;
      background-color: #28a745;
      color: white;
      border: none;
      padding: 14px 0;
      font-size: 18px;
      font-weight: 700;
      border-radius: 14px;
      width: 100%;
      cursor: pointer;
      box-shadow: 0 5px 12px rgba(40,167,69,0.5);
      transition: background-color 0.3s;
    }

    button[type=submit]:hover {
      background-color: #218838;
    }

    #totalAmount {
      font-weight: 700;
      font-size: 20px;
      color: #2e7d32;
      margin-top: 15px;
      text-align: center;
    }

    #successMessage {
      color: #388e3c;
      font-weight: 700;
      margin-top: 18px;
      text-align: center;
      display: none;
      font-size: 17px;
    }

    /* Ø±ÛŒØ³Ù¾Û†Ù†Ø³ÛŒÚ¤ */
    @media (max-width: 900px) {
      .product-list {
        justify-content: flex-start;
      }
      .product {
        width: 140px;
      }
      .product img {
        width: 130px;
        height: 130px;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 15px 10px;
      }
      .product-list {
        flex-direction: column;
        align-items: center;
        gap: 18px;
      }
      .product {
        width: 100%;
        max-width: 350px;
      }
      .product img {
        width: 100%;
        height: auto;
      }
      form {
        position: static;
        box-shadow: none;
        margin: 20px 0 40px 0;
        border-radius: 12px;
      }
    }
  </style>
</head>
<body>

  <h2>ÙÛ†Ø±Ù…ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ú©Ø§ÚµØ§</h2>

  <label for="categoryFilter">ÙÙ„ØªÛ•Ø± Ø¨Û•Ù¾ÛÛŒ Ú©Û•ØªÛ•Ú¯Û†Ø±ÛŒ</label>
  <select id="categoryFilter">
    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú©Û•ØªÛ•Ú¯Û†Ø±ÛŒ</option>
  </select>

  <div class="product-list" id="productList"></div>

  <form id="orderForm" novalidate>
    <label for="customerName">Ù†Ø§ÙˆÛŒ Ú©Ø±ÛŒØ§Ø±</label>
    <input type="text" id="customerName" required placeholder="Ù†Ø§ÙˆÛŒ Ø®Û†Øª Ø¨Ù†ÙˆÙˆØ³Û•" />

    <label for="mobile">Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„</label>
    <input type="text" id="mobile" required placeholder="07XX XXX XXX" />

    <label for="address">Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†</label>
    <input type="text" id="address" required />

    <label for="gps">GPS</label>
    <input type="text" id="gps" readonly placeholder="GPS Ø¨Û•Ø¯Ø±ÙˆØ³ØªÛŒ Ø¯Ø§Ú¯Ø±ØªÙˆÙˆÛ•..." />

    <label for="note">ØªÛØ¨ÛŒÙ†ÛŒ (Note)</label>
    <input type="text" id="note" placeholder="ØªÛØ¨ÛŒÙ†ÛŒÛ•Ú©Ø§Ù†Øª Ø¨Ù†ÙˆÙˆØ³Û•..." />

    <div id="totalAmount">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ: Ù  Ø¯ÛŒÙ†Ø§Ø±</div>

    <button type="submit">âœ… Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ</button>
    <p id="successMessage">âœ… Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÛØ±Ø¯Ø±Ø§!</p>
  </form>

  <script>
    let autoGps = null;
    let products = [];
    let filteredProducts = [];
    let selected = {};
    const productList = document.getElementById('productList');
    const categoryFilter = document.getElementById('categoryFilter');

    async function autoFetchGPS() {
      if (!navigator.geolocation) return;
      navigator.geolocation.getCurrentPosition(pos => {
        autoGps = {
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude
        };
        document.getElementById("gps").value = `${autoGps.latitude.toFixed(5)}, ${autoGps.longitude.toFixed(5)}`;
      }, error => {
        console.warn('Ù†Ø§ØªÙˆØ§Ù†Ø±Ø§ÛŒÛ• GPS Ø¨Ú¯Û•Ú•ÛÙ†Ø±ÛØª:', error.message);
        document.getElementById("gps").value = 'GPS Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•';
      });
    }

    async function loadProductsFromJson() {
      try {
        const response = await fetch('products.json');
        if (!response.ok) throw new Error('Ù†Û•ØªÙˆØ§Ù†Ø±Ø§ ÙØ§ÛŒÙ„ Ø¨Ø®ÙˆÛÙ†Ø¯Ø±ÛØª');
        products = await response.json();

        // Ù¾Ú•Ú©Ø±Ø¯Ù†ÛŒ Ú©Û•ØªÛ•Ú¯Û†Ø±ÛŒÛ•Ú©Ø§Ù† Ù„Û• Ø³Û•ÚµÛÚ©ØªÛ•Ú©Û•
        const categories = [...new Set(products.map(p => p.category).filter(c => c))];
        categoryFilter.innerHTML = `<option value="">Ù‡Û•Ù…ÙˆÙˆ Ú©Û•ØªÛ•Ú¯Û†Ø±ÛŒ</option>`;
        categories.forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          categoryFilter.appendChild(opt);
        });

        filteredProducts = products;
        updateUI();
      } catch (error) {
        console.error('Ù‡Û•ÚµÛ• Ù„Û• Ø®ÙˆÛÙ†Ø¯Ù†Û•ÙˆÛ•ÛŒ products.json:', error);
        productList.innerHTML = '<p style="color:red;">Ù†Ø§ØªÙˆØ§Ù†Ø±Ø§ÛŒÛ• Ú©Ø§ÚµØ§ Ø¨Ø®ÙˆÛÙ†Ø¯Ø±ÛØª.</p>';
      }
    }

    function updateUI() {
      productList.innerHTML = '';

      let total = 0;

      filteredProducts.forEach((product, index) => {
        const id = product.id ?? index;
        const isSelected = selected[id] > 0;

        const div = document.createElement('div');
        div.className = 'product';
        if (isSelected) div.classList.add('selected');

        div.innerHTML = `
          <img src="${product.image}" alt="${product.name}" />
          <strong>${product.name}</strong>
          <div class="price">${product.price.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</div>
        `;

        if (isSelected) {
          const controls = document.createElement('div');
          controls.className = 'quantity-controls';

          const btnMinus = document.createElement('button');
          btnMinus.type = 'button';
          btnMinus.textContent = '-';

          const qtySpan = document.createElement('span');
          qtySpan.textContent = selected[id];

          const btnPlus = document.createElement('button');
          btnPlus.type = 'button';
          btnPlus.textContent = '+';

          btnMinus.onclick = e => {
            e.stopPropagation();
            if (selected[id] > 1) {
              selected[id]--;
            } else {
              delete selected[id];
            }
            updateUI();
          };

          btnPlus.onclick = e => {
            e.stopPropagation();
            selected[id] = (selected[id] || 0) + 1;
            updateUI();
          };

          controls.appendChild(btnMinus);
          controls.appendChild(qtySpan);
          controls.appendChild(btnPlus);

          div.appendChild(controls);

          total += product.price * selected[id];
        }

        div.onclick = () => {
          if (isSelected) {
            delete selected[id];
          } else {
            selected[id] = 1;
          }
          updateUI();
        };

        productList.appendChild(div);
      });

      document.getElementById('totalAmount').textContent = `Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ: ${total.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±`;
    }

    categoryFilter.addEventListener('change', () => {
      const cat = categoryFilter.value;
      if (!cat) {
        filteredProducts = products;
      } else {
        filteredProducts = products.filter(p => p.category === cat);
      }
      selected = {};
      updateUI();
    });

    window.addEventListener('DOMContentLoaded', () => {
      autoFetchGPS();
      loadProductsFromJson();
    });

    document.getElementById('orderForm').addEventListener('submit', e => {
      e.preventDefault();

      const name = document.getElementById('customerName').value.trim();
      const mobile = document.getElementById('mobile').value.trim();
      const address = document.getElementById('address').value.trim();
      const note = document.getElementById('note').value.trim();

      if (!name || !mobile || !address) {
        alert('ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•.');
        return;
      }

      if (Object.keys(selected).length === 0) {
        alert('ØªÚ©Ø§ÛŒÛ• Ú©Ø§ÚµØ§ÛŒÛ•Ú© Ù‡Û•Ù„Ø¨Ú˜ÛØ±Û•.');
        return;
      }

      const gps = autoGps ? `${autoGps.latitude.toFixed(5)}, ${autoGps.longitude.toFixed(5)}` : '';

      const selectedProducts = products
        .filter(p => selected[p.id ?? products.indexOf(p)])
        .map(p => ({
          id: p.id,
          name: p.name,
          price: p.price,
          quantity: selected[p.id ?? products.indexOf(p)],
          totalPrice: p.price * selected[p.id ?? products.indexOf(p)]
        }));

      const totalAmount = selectedProducts.reduce((sum, p) => sum + p.totalPrice, 0);

      const order = {
        id: Date.now(),
        name,
        mobile,
        address,
        note,
        products: selectedProducts,
        time: new Date().toLocaleString(),
        gps,
        total: totalAmount
      };

      let orders = JSON.parse(localStorage.getItem('orders') || '[]');
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));

      const orderText = `
ğŸ§¾ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ - ${order.time}

ğŸ‘¤ Ú©Ø±ÛŒØ§Ø±: ${order.name}
ğŸ“ Ù…Û†Ø¨Ø§ÛŒÙ„: ${order.mobile}
ğŸ“ Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†: ${order.address}
ğŸ“¡ GPS: ${order.gps}
ğŸ“ ØªÛØ¨ÛŒÙ†ÛŒ: ${order.note || 'Ù‡ÛŒÚ†ÛŒ Ù†ÛŒÛŒÛ•'}

ğŸ“¦ Ú©Ø§ÚµØ§Ú©Ø§Ù†:
${order.products.map(p => `- ${p.name} Ã— ${p.quantity} = ${p.totalPrice.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±`).join('\n')}

ğŸ’° Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ: ${order.total.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±
`;
      const encodedText = encodeURIComponent(orderText);
      const whatsappUrl = `https://wa.me/9647502020061?text=${encodedText}`;
      window.open(whatsappUrl, '_blank');

      selected = {};
      document.getElementById('orderForm').reset();
      document.getElementById('gps').value = '';
      autoFetchGPS();
      updateUI();

      const successMsg = document.getElementById('successMessage');
      successMsg.style.display = 'block';
      setTimeout(() => {
        successMsg.style.display = 'none';
      }, 3000);
    });
  </script>

</body>
</html>
